{% extends "layout.html" %}
{% block ngdeclare %}ng-controller="LogsCtrl"{% endblock %}
{% block navbar %}
<ul class="nav navbar-nav navbar-right">
    <li>
        <p class="navbar-text">
            <label>
                <input type="checkbox" ng-model="autoscroll"> auto scroll
            </label>
        </p>
    </li>
</ul>
<!--
<form class="navbar-form navbar-left" role="search">
  <div class="form-group">
    <input type="text" class="form-control" placeholder="Search">
  </div>
  <button type="submit" class="btn btn-default">Submit</button>
</form>
-->
{% endblock %}
{% block content %}
{% raw %}
<div class="row">
    <div class="col-xs-12 bg-danger">err</div>
    <div class="col-xs-12 bg-warning">log</div>
    <div class="col-xs-12 ">info</div>
    <div class="col-xs-12 bg-success">success</div>
    <div class="col-xs-12 bg-primary">yeah</div>
    <div class="col-xs-12" ng-repeat="record in log track by $index">
        {{ record }}
    </div>
</div>
<div id="bottom" class="row"></div>
{% endraw %}
{% endblock %}
{% block javascript %}
<script>
    myApp.controller('LogsCtrl', ['$scope', '$log', '$window', '$location', '$anchorScroll',
        function ($scope, $log, $window, $location, $anchorScroll) {
            $scope.autoscroll = true;
            $scope.log = [];
            $scope.ws = new WebSocket("{{ ws_addr }}");
            $window.onbeforeunload = function (e) {
                $log.log("Bye bye...");
                if (!e) e = $window.event;
                e.stopPropagation();
                e.preventDefault();
            };
            $scope.ws.onmessage = function (evt) {
                $scope.log.push(evt.data);
                $scope.$apply();
                if ($scope.autoscroll) {
                    $location.hash('bottom');
                    $anchorScroll();
                }
            };
            $scope.ws.onopen = function () {
                $scope.ws.send("{{ username }} entered the room");
            };
            $scope.ws.onclose = function (evt) {
                $scope.log.push("Connection closed by server: " + evt.code + " \'" + evt.reason + "\'");
            };
//        $("#send").click(function () {
//            console.log($("#message").val());
//            ws.send("{{ username }}: " + $("#message").val());
//            $("#message").val("");
//            return false;
//        });

        }]);

</script>
{% endblock %}
{% block nothere %}
<!--<!DOCTYPE html>
<html>
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
      <style>
        body { padding-top: 20px; background-color: #333; color: #fff; }
        #chat { width: 100%; height: 300px;  color: #333; }
      </style>

      <script type="application/javascript" src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
      <script type="application/javascript" src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
      <script type="application/javascript">
        $(document).ready(function() {
          var ws = new WebSocket("{{ ws_addr }}");
          window.onbeforeunload = function(e) {
            $("#chat").val($("#chat").val() + "Bye bye...\n");
            ws.close(1000, "{{ username }} left the room");
            if(!e) e = window.event;
            e.stopPropagation();
            e.preventDefault();
          };
          ws.onmessage = function (evt) {
             $("#chat").val($("#chat").val() + evt.data + "\n");
          };
          ws.onopen = function() {
             ws.send("%(username)s entered the room");
          };
          ws.onclose = function(evt) {
             $("#chat").val($("#chat").val() + "Connection closed by server: " + evt.code + " \'" + evt.reason + "\'\n");
          };
          $("#send").click(function() {
             console.log($("#message").val());
             ws.send("{{ username }}: " + $("#message").val());
             $("#message").val("");
             return false;
          });
        });
      </script>
    </head>
    <body>
      <div class="container">
        <div class="row">
	  <textarea id="chat" readonly="readonly"></textarea>
	</div>

        <div class="row">
	<form action="#" id="chatform" method="get" class="form-horizontal" role="form">
          <div class="form-group">
	    <div class="col-sm-4">
	      <input class="form-control input-sm" type="text" id="message" />
	    </div>
	    <div class="col-sm-1">
	      <button id="send" type="submit" class="btn btn-default btn-sm">Send</button>
	    </div>
	  </div>
	</form>
	</div>
      </div>
    </body>
</html>
-->
{% endblock %}
